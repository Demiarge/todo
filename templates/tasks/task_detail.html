{% extends 'base.html' %}
{% block title %}{{ task.title }} – Task Manager{% endblock %}
{% block content %}
<div class="card">
  <div style="margin-bottom: 0.75rem; display: flex; flex-wrap: wrap; gap: 0.5rem;">
    <span class="badge badge-{{ task.priority }}">{{ task.get_priority_display }}</span>
    <span class="badge badge-{{ task.status }}">{{ task.get_status_display }}</span>
    {% if task.is_overdue %}<span class="overdue">Overdue</span>{% endif %}
  </div>
  <h1 class="page-title" style="margin-top: 0;">{{ task.title }}</h1>
  <p style="color: var(--text-muted); margin: 0.5rem 0;"><strong style="color: var(--text);">Creator</strong> {{     task.creator.username }}</p>
  {% if task.due_date %}<p style="color: var(--text-muted); margin: 0.5rem 0;"><strong
      style="color: var(--text);">Due</strong> {{ task.due_date }}</p>{% endif %}
  {% if task.description %}<p style="margin: 1rem 0;">{{ task.description }}</p>{% endif %}
  <p style="color: var(--text-muted); margin: 0.5rem 0;"><strong style="color: var(--text);">Assigned to</strong> {% for     u in task.assigned_users.all %}{{ u.username }}{% if not forloop.last %}, {% endif %}{% empty %}—{% endfor %}</p>
  <p style="color: var(--text-muted); font-size: 0.85rem; margin-top: 1rem;">Created {{ task.created_at }} · Updated {{     task.updated_at }}</p>

  {% if can_update_status and status_form %}
  <form method="post" action="{% url 'tasks:task_update_status' task.slug %}"
    style="margin-top: 1.5rem; display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap;">
    {% csrf_token %}
    {{ status_form.status }}
    <button type="submit" class="btn btn-success">Update status</button>
  </form>
  {% endif %}

  <div style="margin-top: 1.5rem; display: flex; gap: 0.75rem; flex-wrap: wrap;">
    {% if can_edit %}
    <a href="{% url 'tasks:task_edit' task.slug %}" class="btn btn-primary">Edit</a>
    <a href="{% url 'tasks:task_delete' task.slug %}" class="btn btn-danger">Delete</a>
    {% endif %}
    <a href="{% url 'tasks:dashboard' %}" class="btn btn-secondary">Back to dashboard</a>
  </div>
</div>

<div class="card" style="margin-top: 1.5rem;">
  <h3 style="font-size: 1.1rem; font-weight: 600; color: var(--text-muted); margin: 0 0 1rem;">Comments</h3>
  {% for c in comments %}
  <div style="padding: 0.75rem 0; border-bottom: 1px solid var(--border);">
    <strong style="color: var(--text);">{{ c.user.username }}</strong>
    <span style="color: var(--text-muted); font-size: 0.85rem;"> · {{ c.created_at }}</span>
    <p style="margin: 0.35rem 0 0; white-space: pre-wrap;">{{ c.text }}</p>
  </div>
  {% empty %}
  <p style="color: var(--text-muted); margin: 0;">No comments yet.</p>
  {% endfor %}
  <form method="post" action="{% url 'tasks:task_add_comment' task.slug %}" style="margin-top: 1rem;">
    {% csrf_token %}
    {{ comment_form.text }}
    <button type="submit" class="btn btn-primary" style="margin-top: 0.5rem;">Add comment</button>
  </form>
</div>
{% endblock %}